{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/lib/ingestedClaims.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\n\nconst DATA_DIR = path.join(process.cwd(), 'data')\nconst INGESTED_DIR = path.join(DATA_DIR, 'ingested-attachments')\nconst CLAIMS_FILE = path.join(DATA_DIR, 'ingested-claims.json')\n\nexport interface IngestedAttachment {\n  name: string\n  path: string\n  size: number\n  mimeType: string\n}\n\nexport interface IngestedClaim {\n  id: string\n  policyNumber: string\n  from: string\n  to: string\n  subject: string\n  emailBody: string\n  attachments: IngestedAttachment[]\n  createdAt: string\n  source: 'sendgrid' | 'demo' | 'imap'\n  messageId?: string\n}\n\nfunction ensureDataDir() {\n  if (!fs.existsSync(DATA_DIR)) {\n    fs.mkdirSync(DATA_DIR, { recursive: true })\n  }\n  if (!fs.existsSync(INGESTED_DIR)) {\n    fs.mkdirSync(INGESTED_DIR, { recursive: true })\n  }\n}\n\nfunction getClaimsData(): IngestedClaim[] {\n  ensureDataDir()\n  if (!fs.existsSync(CLAIMS_FILE)) {\n    return []\n  }\n  try {\n    const content = fs.readFileSync(CLAIMS_FILE, 'utf-8')\n    return JSON.parse(content)\n  } catch {\n    return []\n  }\n}\n\nfunction saveClaimsData(claims: IngestedClaim[]) {\n  ensureDataDir()\n  fs.writeFileSync(CLAIMS_FILE, JSON.stringify(claims, null, 2), 'utf-8')\n}\n\n/** Extract policy number from email body using common patterns */\nexport function extractPolicyNumber(emailBody: string): string | null {\n  const patterns = [\n    /policy\\s*#?\\s*:?\\s*([A-Z0-9]{6,})/i,\n    /policy\\s*number\\s*:?\\s*([A-Z0-9]{6,})/i,\n    /Policy\\s*#([A-Z0-9]+)/i,\n    /#([A-Z]{2}\\d{6,})/,\n    /\\b([A-Z]{2}\\d{6,})\\b/,\n  ]\n  for (const pattern of patterns) {\n    const match = emailBody.match(pattern)\n    if (match && match[1]) {\n      return match[1]\n    }\n  }\n  return null\n}\n\nfunction normalizeDedupKey(s: string): string {\n  return s.trim().toLowerCase()\n}\n\nfunction normalizedSubjectFrom(subject: string, from: string): string {\n  return normalizeDedupKey(`${subject}|${from}`)\n}\n\n/** Get existing message IDs / dedup keys for avoiding re-ingestion.\n * Adds both Message-ID (raw + normalized) and subject|from for each claim\n * so duplicates are caught even when Message-ID varies (forward/reply) or is missing.\n */\nexport function getExistingMessageIds(): Set<string> {\n  const claims = getClaimsData()\n  const ids = new Set<string>()\n  for (const c of claims) {\n    ids.add(normalizedSubjectFrom(c.subject, c.from))\n    if (c.messageId) {\n      ids.add(normalizeDedupKey(c.messageId))\n      const inner = c.messageId.replace(/^<|>$/g, '').trim()\n      if (inner) ids.add(normalizeDedupKey(inner))\n    }\n  }\n  return ids\n}\n\n/** Add dedup keys for a newly ingested claim so future syncs can detect duplicates */\nexport function addDedupKeysToSet(\n  ids: Set<string>,\n  subject: string,\n  from: string,\n  messageId: string,\n  dedupKey: string\n): void {\n  ids.add(normalizedSubjectFrom(subject, from))\n  ids.add(normalizeDedupKey(dedupKey))\n  if (messageId) {\n    const inner = messageId.replace(/^<|>$/g, '').trim()\n    if (inner) ids.add(normalizeDedupKey(inner))\n  }\n}\n\n/** Check if email is a duplicate using normalized dedup keys */\nexport function isDuplicateEmail(\n  subject: string,\n  from: string,\n  messageId: string,\n  dateHeader: string,\n  existingIds: Set<string>\n): boolean {\n  const subjectFrom = normalizedSubjectFrom(subject, from)\n  if (existingIds.has(subjectFrom)) return true\n  const dedupKey = messageId\n    ? normalizeDedupKey(messageId)\n    : normalizeDedupKey(`${subject}|${from}|${dateHeader}`)\n  if (existingIds.has(dedupKey)) return true\n  if (messageId) {\n    const inner = messageId.replace(/^<|>$/g, '').trim()\n    if (inner && existingIds.has(normalizeDedupKey(inner))) return true\n  }\n  return false\n}\n\n/** Use email Message-ID as identifier when policy number not found */\nfunction fallbackPolicyDisplay(messageId: string | undefined, claimId: string): string {\n  if (!messageId) return claimId\n  // Message-ID format: <local@domain> - use the email ID itself (strip angle brackets)\n  if (messageId.includes('<') && messageId.includes('@')) {\n    const inner = messageId.replace(/^<|>$/g, '').trim()\n    return inner || claimId\n  }\n  return claimId\n}\n\n/** Save an ingested claim (from SendGrid, IMAP, or other source).\n * messageId: dedup key (stored in claim). emailMessageIdForDisplay: RFC Message-ID for fallback when no policy.\n */\nexport function saveIngestedClaim(\n  from: string,\n  to: string,\n  subject: string,\n  emailBody: string,\n  attachmentFiles: Array<{ name: string; buffer: Buffer; mimeType: string }>,\n  source: 'sendgrid' | 'imap' = 'sendgrid',\n  messageId?: string,\n  emailMessageIdForDisplay?: string\n): IngestedClaim {\n  const claimId = `ING-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`\n  const extracted = extractPolicyNumber(emailBody) || extractPolicyNumber(subject)\n  const policyNumber = extracted ?? fallbackPolicyDisplay(emailMessageIdForDisplay ?? messageId, claimId)\n\n  ensureDataDir()\n  const claimDir = path.join(INGESTED_DIR, claimId)\n  fs.mkdirSync(claimDir, { recursive: true })\n\n  const attachments: IngestedAttachment[] = []\n  for (const file of attachmentFiles) {\n    const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_')\n    const filePath = path.join(claimDir, safeName)\n    fs.writeFileSync(filePath, file.buffer)\n    attachments.push({\n      name: file.name,\n      path: filePath,\n      size: file.buffer.length,\n      mimeType: file.mimeType || 'application/octet-stream',\n    })\n  }\n\n  const claim: IngestedClaim = {\n    id: claimId,\n    policyNumber,\n    from,\n    to,\n    subject,\n    emailBody,\n    attachments,\n    createdAt: new Date().toISOString(),\n    source,\n  }\n  if (messageId) claim.messageId = messageId\n\n  const claims = getClaimsData()\n  claims.unshift(claim)\n  saveClaimsData(claims)\n  return claim\n}\n\n/** Get all ingested claims (for dropdown). Excludes demo if any real (imap/sendgrid) claims exist. */\nexport function getAllIngestedClaims(): IngestedClaim[] {\n  let claims = getClaimsData()\n  if (claims.length === 0) {\n    seedDemoClaims()\n    claims = getClaimsData()\n  }\n  const hasRealClaims = claims.some((c) => c.source === 'imap' || c.source === 'sendgrid')\n  if (hasRealClaims) {\n    return claims.filter((c) => c.source !== 'demo')\n  }\n  return claims\n}\n\n/** Get a single claim by ID */\nexport function getIngestedClaimById(id: string): IngestedClaim | null {\n  const claims = getClaimsData()\n  return claims.find((c) => c.id === id) || null\n}\n\n/** Get distinct policy numbers for dropdown. Excludes demo if any real (imap/sendgrid) claims exist. */\nexport function getPolicyNumbers(): Array<{ id: string; policyNumber: string; subject: string }> {\n  let claims = getClaimsData()\n  if (claims.length === 0) {\n    seedDemoClaims()\n    claims = getClaimsData()\n  }\n  const hasRealClaims = claims.some((c) => c.source === 'imap' || c.source === 'sendgrid')\n  const toShow = hasRealClaims ? claims.filter((c) => c.source !== 'demo') : claims\n  return toShow.map((c) => ({\n    id: c.id,\n    policyNumber: c.policyNumber,\n    subject: c.subject,\n  }))\n}\n\n/** Seed demo claims from scenarios folder when no claims exist */\nfunction seedDemoClaims() {\n  const scenariosDir = path.join(process.cwd(), 'demo-data', 'scenarios')\n  if (!fs.existsSync(scenariosDir)) return\n\n  const scenarios = [\n    { folder: 'auto-collision', policyNumber: 'AC789456123', from: 'sarah.johnson@email.com', to: 'pranay.nath@aimill.in', subject: 'Car Accident Claim - Policy #AC789456123' },\n    { folder: 'commercial-liability', policyNumber: 'CL789012345', from: 'antonio.martinez@tonysrestaurant.com', to: 'pranay.nath@aimill.in', subject: 'Commercial Liability Claim - Slip and Fall - Policy #CL789012345' },\n    { folder: 'property-water-damage', policyNumber: 'HO456789234', from: 'robert.chen@email.com', to: 'pranay.nath@aimill.in', subject: 'Urgent - Water Damage Claim - Policy #HO456789234' },\n  ]\n\n  const claims: IngestedClaim[] = []\n  const baseTime = Date.now() - 86400000 * 2\n\n  for (let i = 0; i < scenarios.length; i++) {\n    const s = scenarios[i]\n    const emailPath = path.join(scenariosDir, s.folder, 'email.txt')\n    const attachmentsDir = path.join(scenariosDir, s.folder, 'attachments')\n    if (!fs.existsSync(emailPath)) continue\n\n    const emailBody = fs.readFileSync(emailPath, 'utf-8')\n    const claimId = `DEMO-${s.policyNumber}-${i}`\n    const claimDir = path.join(INGESTED_DIR, claimId)\n    fs.mkdirSync(claimDir, { recursive: true })\n\n    const attachments: IngestedAttachment[] = []\n    if (fs.existsSync(attachmentsDir)) {\n      for (const file of fs.readdirSync(attachmentsDir)) {\n        const srcPath = path.join(attachmentsDir, file)\n        if (fs.statSync(srcPath).isFile()) {\n          const destPath = path.join(claimDir, file)\n          fs.copyFileSync(srcPath, destPath)\n          attachments.push({ name: file, path: destPath, size: fs.statSync(destPath).size, mimeType: 'text/plain' })\n        }\n      }\n    }\n\n    claims.push({\n      id: claimId,\n      policyNumber: s.policyNumber,\n      from: s.from,\n      to: s.to,\n      subject: s.subject,\n      emailBody,\n      attachments,\n      createdAt: new Date(baseTime + i * 3600000).toISOString(),\n      source: 'demo',\n    })\n  }\n\n  if (claims.length > 0) {\n    saveClaimsData(claims)\n  }\n}\n\n/** Clear all ingested claims and attachments (for fresh start) */\nexport function clearAllIngestedClaims(): void {\n  ensureDataDir()\n  if (fs.existsSync(CLAIMS_FILE)) fs.unlinkSync(CLAIMS_FILE)\n  if (fs.existsSync(INGESTED_DIR)) {\n    for (const entry of fs.readdirSync(INGESTED_DIR, { withFileTypes: true })) {\n      const fullPath = path.join(INGESTED_DIR, entry.name)\n      if (entry.isDirectory()) {\n        fs.rmSync(fullPath, { recursive: true })\n      }\n    }\n  }\n}\n\n/** Read attachment file content for processing (text files) */\nexport function readAttachmentContent(claimId: string, attachmentName: string): string {\n  const claim = getIngestedClaimById(claimId)\n  if (!claim) throw new Error('Claim not found')\n  const att = claim.attachments.find((a) => a.name === attachmentName)\n  if (!att || !fs.existsSync(att.path)) throw new Error('Attachment not found')\n  const ext = path.extname(att.name).toLowerCase()\n  if (['.txt', '.csv', '.log'].includes(ext)) {\n    return fs.readFileSync(att.path, 'utf-8')\n  }\n  return `[Document: ${att.name} - content extracted for processing]`\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/lib/processedClaims.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\nimport { ClaimData } from '@/types/claims'\n\nconst DATA_DIR = path.join(process.cwd(), 'data')\nconst CLAIMS_DIR = path.join(DATA_DIR, 'processed-claims')\nconst INDEX_FILE = path.join(CLAIMS_DIR, 'claims-index.json')\nconst CSV_FILE = path.join(CLAIMS_DIR, 'claims-history.csv')\n\nexport interface ProcessedClaimSummary {\n  claimId: string\n  ingestedClaimId?: string\n  policyNumber?: string\n  claimantName?: string\n  createdAt: string\n}\n\nfunction ensureDir() {\n  if (!fs.existsSync(DATA_DIR)) fs.mkdirSync(DATA_DIR, { recursive: true })\n  if (!fs.existsSync(CLAIMS_DIR)) fs.mkdirSync(CLAIMS_DIR, { recursive: true })\n}\n\nfunction getIndex(): Array<{ claimId: string; ingestedClaimId?: string; policyNumber?: string; claimantName?: string; createdAt: string; filePath: string }> {\n  ensureDir()\n  if (!fs.existsSync(INDEX_FILE)) return []\n  try {\n    return JSON.parse(fs.readFileSync(INDEX_FILE, 'utf-8'))\n  } catch {\n    return []\n  }\n}\n\nfunction saveIndex(index: ReturnType<typeof getIndex>) {\n  ensureDir()\n  fs.writeFileSync(INDEX_FILE, JSON.stringify(index, null, 2), 'utf-8')\n}\n\nfunction escapeCsv(val: unknown): string {\n  if (val == null || val === undefined) return ''\n  const s = String(val)\n  if (s.includes(',') || s.includes('\"') || s.includes('\\n')) {\n    return `\"${s.replace(/\"/g, '\"\"')}\"`\n  }\n  return s\n}\n\nfunction appendToCsv(claim: ClaimData) {\n  ensureDir()\n  const draft = claim.decisionPack?.claimDraft\n  const isNew = !fs.existsSync(CSV_FILE)\n  const headers = [\n    'claimId',\n    'ingestedClaimId',\n    'policyNumber',\n    'claimantName',\n    'contactEmail',\n    'contactPhone',\n    'lossDate',\n    'lossType',\n    'lossLocation',\n    'description',\n    'status',\n    'createdAt',\n  ]\n  const row = [\n    claim.claimId ?? '',\n    claim.ingestedClaimId ?? '',\n    draft?.policyNumber ?? '',\n    draft?.claimantName ?? '',\n    draft?.contactEmail ?? '',\n    draft?.contactPhone ?? '',\n    draft?.lossDate ?? '',\n    draft?.lossType ?? '',\n    (draft?.lossLocation || draft?.location) ?? '',\n    draft?.description ?? '',\n    claim.status ?? '',\n    claim.createdAt ?? new Date().toISOString(),\n  ]\n  const line = isNew ? headers.map(escapeCsv).join(',') + '\\n' : ''\n  fs.appendFileSync(CSV_FILE, line + row.map(escapeCsv).join(',') + '\\n', 'utf-8')\n}\n\nexport function saveProcessedClaim(claim: ClaimData): void {\n  ensureDir()\n  const claimId = claim.claimId || `CLM-${Date.now()}`\n  const filePath = path.join(CLAIMS_DIR, `${claimId.replace(/[/\\\\:]/g, '_')}.json`)\n\n  const toSave = { ...claim, claimId }\n  fs.writeFileSync(filePath, JSON.stringify(toSave, null, 2), 'utf-8')\n\n  const draft = claim.decisionPack?.claimDraft\n  const index = getIndex()\n  const existing = index.findIndex((e) => e.claimId === claimId)\n  if (existing < 0) appendToCsv(toSave)\n  const entry = {\n    claimId,\n    ingestedClaimId: claim.ingestedClaimId,\n    policyNumber: draft?.policyNumber,\n    claimantName: draft?.claimantName,\n    createdAt: claim.createdAt || new Date().toISOString(),\n    filePath,\n  }\n  if (existing >= 0) {\n    index[existing] = entry\n  } else {\n    index.unshift(entry)\n  }\n  saveIndex(index)\n}\n\nexport function getProcessedClaimSummaries(): ProcessedClaimSummary[] {\n  const index = getIndex()\n  return index.map(({ claimId, ingestedClaimId, policyNumber, claimantName, createdAt }) => ({\n    claimId,\n    ingestedClaimId,\n    policyNumber,\n    claimantName,\n    createdAt,\n  }))\n}\n\nexport function getProcessedClaimById(claimId: string): ClaimData | null {\n  const index = getIndex()\n  const entry = index.find((e) => e.claimId === claimId)\n  if (!entry || !fs.existsSync(entry.filePath)) return null\n  try {\n    return JSON.parse(fs.readFileSync(entry.filePath, 'utf-8')) as ClaimData\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAGA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC1C,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AACvC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,YAAY;AACzC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;AAUvC,SAAS;IACP,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW,wGAAE,CAAC,SAAS,CAAC,UAAU;QAAE,WAAW;IAAK;IACvE,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa,wGAAE,CAAC,SAAS,CAAC,YAAY;QAAE,WAAW;IAAK;AAC7E;AAEA,SAAS;IACP;IACA,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa,OAAO,EAAE;IACzC,IAAI;QACF,OAAO,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,YAAY;IAChD,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEA,SAAS,UAAU,KAAkC;IACnD;IACA,wGAAE,CAAC,aAAa,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM,IAAI;AAC/D;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,QAAQ,WAAW,OAAO;IAC7C,MAAM,IAAI,OAAO;IACjB,IAAI,EAAE,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,OAAO;QAC1D,OAAO,CAAC,CAAC,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;IACrC;IACA,OAAO;AACT;AAEA,SAAS,YAAY,KAAgB;IACnC;IACA,MAAM,QAAQ,MAAM,YAAY,EAAE;IAClC,MAAM,QAAQ,CAAC,wGAAE,CAAC,UAAU,CAAC;IAC7B,MAAM,UAAU;QACd;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,MAAM,MAAM;QACV,MAAM,OAAO,IAAI;QACjB,MAAM,eAAe,IAAI;QACzB,OAAO,gBAAgB;QACvB,OAAO,gBAAgB;QACvB,OAAO,gBAAgB;QACvB,OAAO,gBAAgB;QACvB,OAAO,YAAY;QACnB,OAAO,YAAY;QACnB,CAAC,OAAO,gBAAgB,OAAO,QAAQ,KAAK;QAC5C,OAAO,eAAe;QACtB,MAAM,MAAM,IAAI;QAChB,MAAM,SAAS,IAAI,IAAI,OAAO,WAAW;KAC1C;IACD,MAAM,OAAO,QAAQ,QAAQ,GAAG,CAAC,WAAW,IAAI,CAAC,OAAO,OAAO;IAC/D,wGAAE,CAAC,cAAc,CAAC,UAAU,OAAO,IAAI,GAAG,CAAC,WAAW,IAAI,CAAC,OAAO,MAAM;AAC1E;AAEO,SAAS,mBAAmB,KAAgB;IACjD;IACA,MAAM,UAAU,MAAM,OAAO,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;IACpD,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY,GAAG,QAAQ,OAAO,CAAC,WAAW,KAAK,KAAK,CAAC;IAEhF,MAAM,SAAS;QAAE,GAAG,KAAK;QAAE;IAAQ;IACnC,wGAAE,CAAC,aAAa,CAAC,UAAU,KAAK,SAAS,CAAC,QAAQ,MAAM,IAAI;IAE5D,MAAM,QAAQ,MAAM,YAAY,EAAE;IAClC,MAAM,QAAQ;IACd,MAAM,WAAW,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IACtD,IAAI,WAAW,GAAG,YAAY;IAC9B,MAAM,QAAQ;QACZ;QACA,iBAAiB,MAAM,eAAe;QACtC,cAAc,OAAO;QACrB,cAAc,OAAO;QACrB,WAAW,MAAM,SAAS,IAAI,IAAI,OAAO,WAAW;QACpD;IACF;IACA,IAAI,YAAY,GAAG;QACjB,KAAK,CAAC,SAAS,GAAG;IACpB,OAAO;QACL,MAAM,OAAO,CAAC;IAChB;IACA,UAAU;AACZ;AAEO,SAAS;IACd,MAAM,QAAQ;IACd,OAAO,MAAM,GAAG,CAAC,CAAC,EAAE,OAAO,EAAE,eAAe,EAAE,YAAY,EAAE,YAAY,EAAE,SAAS,EAAE,GAAK,CAAC;YACzF;YACA;YACA;YACA;YACA;QACF,CAAC;AACH;AAEO,SAAS,sBAAsB,OAAe;IACnD,MAAM,QAAQ;IACd,MAAM,QAAQ,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK;IAC9C,IAAI,CAAC,SAAS,CAAC,wGAAE,CAAC,UAAU,CAAC,MAAM,QAAQ,GAAG,OAAO;IACrD,IAAI;QACF,OAAO,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,MAAM,QAAQ,EAAE;IACpD,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 484, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/lib/policyClauses.ts"],"sourcesContent":["/**\n * Policy clauses database and matching logic.\n * Provides realistic policy grounding based on extracted claim fields.\n */\n\nimport type { PolicyHit } from '@/types/claims'\n\nexport interface PolicyClause {\n  clauseId: string\n  title: string\n  section: string\n  content: string\n  lossTypes: string[]\n  productTypes: string[]\n}\n\nconst POLICY_CLAUSES: PolicyClause[] = [\n  {\n    clauseId: 'AUTO-PD-001',\n    title: 'Property Damage – Collision Coverage',\n    section: 'Part D – Collision',\n    content:\n      'We will pay for direct and accidental loss to your covered auto caused by collision. Collision means the upset of your covered auto or its impact with another vehicle or object. Deductible applies as shown in your Declarations.',\n    lossTypes: ['collision', 'autocollision', 'auto'],\n    productTypes: ['auto', 'ac'],\n  },\n  {\n    clauseId: 'AUTO-BI-002',\n    title: 'Bodily Injury Liability',\n    section: 'Part A – Liability',\n    content:\n      'We will pay damages for bodily injury or death for which any insured becomes legally responsible because of an auto accident. We will settle or defend, as we consider appropriate, any claim or suit asking for these damages.',\n    lossTypes: ['collision', 'autocollision', 'liability', 'bodily injury'],\n    productTypes: ['auto', 'ac', 'cl'],\n  },\n  {\n    clauseId: 'AUTO-UM-003',\n    title: 'Uninsured Motorist Coverage',\n    section: 'Part C – Uninsured Motorists',\n    content:\n      'We will pay compensatory damages which an insured is legally entitled to recover from the owner or operator of an uninsured motor vehicle because of bodily injury sustained by an insured caused by an accident.',\n    lossTypes: ['collision', 'autocollision'],\n    productTypes: ['auto', 'ac'],\n  },\n  {\n    clauseId: 'HO-00-004',\n    title: 'Water Damage – Sudden and Accidental',\n    section: 'Section I – Property Coverages',\n    content:\n      'We insure for direct physical loss to property described in Coverage A and B caused by: (8) accidental discharge or overflow of water or steam from within a plumbing, heating, air conditioning system or household appliance. This does not include loss from constant or repeated seepage.',\n    lossTypes: ['water', 'propertydamage', 'property'],\n    productTypes: ['home', 'ho', 'property'],\n  },\n  {\n    clauseId: 'HO-WIND-005',\n    title: 'Windstorm and Hail – Roof Damage',\n    section: 'Section I – Property Coverages',\n    content:\n      'We insure for direct physical loss to property caused by windstorm or hail. This includes damage to roofs, siding, and other exterior surfaces. Tree limb damage to roof resulting in water intrusion is covered under this provision when windstorm is the proximate cause.',\n    lossTypes: ['water', 'propertydamage', 'property', 'storm'],\n    productTypes: ['home', 'ho', 'property'],\n  },\n  {\n    clauseId: 'HO-DED-006',\n    title: 'Deductible Application',\n    section: 'Section I – Conditions',\n    content:\n      'Our payment for loss will be the amount of loss minus your deductible. Wind/hail deductible: 1% of Coverage A limit. All other perils: $500 or as stated in Declarations. Deductible applies per occurrence.',\n    lossTypes: ['water', 'fire', 'theft', 'propertydamage', 'collision'],\n    productTypes: ['home', 'ho', 'auto', 'ac'],\n  },\n  {\n    clauseId: 'HO-FIRE-007',\n    title: 'Fire and Lightning Coverage',\n    section: 'Section I – Property Coverages',\n    content:\n      'We insure for direct physical loss to property caused by fire or lightning. This includes loss from smoke, soot, and water or other substances used to extinguish the fire. Debris removal is included.',\n    lossTypes: ['fire', 'propertydamage', 'property'],\n    productTypes: ['home', 'ho', 'property'],\n  },\n  {\n    clauseId: 'HO-THEFT-008',\n    title: 'Theft Coverage',\n    section: 'Section I – Property Coverages',\n    content:\n      'We insure for direct physical loss to property caused by theft, including attempted theft. This includes loss of property from a known place when it is likely that the property has been stolen. Proof of loss may be required.',\n    lossTypes: ['theft', 'propertydamage'],\n    productTypes: ['home', 'ho', 'property'],\n  },\n  {\n    clauseId: 'CL-GL-009',\n    title: 'General Liability – Bodily Injury',\n    section: 'Coverage A – Bodily Injury and Property Damage',\n    content:\n      'We will pay those sums that the insured becomes legally obligated to pay as damages because of bodily injury or property damage to which this insurance applies. We have the right and duty to defend the insured against any suit seeking these damages.',\n    lossTypes: ['liability', 'slip and fall', 'bodily injury'],\n    productTypes: ['commercial', 'cl'],\n  },\n  {\n    clauseId: 'CL-PREM-010',\n    title: 'Premises Liability – Slip and Fall',\n    section: 'Coverage A – Bodily Injury',\n    content:\n      'Coverage applies to bodily injury arising out of the ownership, maintenance or use of the premises shown in the Declarations. This includes injuries from slip, trip and fall on your premises. Medical expenses are covered subject to policy limits.',\n    lossTypes: ['liability', 'slip and fall', 'premises'],\n    productTypes: ['commercial', 'cl'],\n  },\n  {\n    clauseId: 'GEN-NOC-011',\n    title: 'Notice of Claim',\n    section: 'Conditions',\n    content:\n      'In case of a loss, you must give prompt notice to us or our agent. You must also give us a description of how, when and where the loss occurred. You must protect the property from further damage and keep a record of expenses.',\n    lossTypes: ['collision', 'water', 'fire', 'theft', 'liability', 'propertydamage', 'other'],\n    productTypes: ['auto', 'home', 'commercial', 'ac', 'ho', 'cl'],\n  },\n  {\n    clauseId: 'GEN-COOP-012',\n    title: 'Duties After Loss',\n    section: 'Conditions',\n    content:\n      'You must cooperate with us in the investigation of a claim. You must submit to examination under oath. You must provide documents we reasonably request. Failure to comply may affect coverage.',\n    lossTypes: ['collision', 'water', 'fire', 'theft', 'liability', 'other'],\n    productTypes: ['auto', 'home', 'commercial', 'ac', 'ho', 'cl'],\n  },\n]\n\nfunction inferProductTypes(policyNumber: string): string[] {\n  const p = (policyNumber || '').toUpperCase().replace(/\\*+/g, '').trim()\n  if (p.startsWith('AC') || p.startsWith('AUTO')) return ['auto', 'ac']\n  if (p.startsWith('HO') || p.startsWith('HP') || p.startsWith('PROP')) return ['home', 'ho', 'property']\n  if (p.startsWith('CL') || p.startsWith('GL') || p.startsWith('COM')) return ['commercial', 'cl']\n  return ['auto', 'home', 'commercial', 'ac', 'ho', 'cl']\n}\n\nfunction inferLossTypes(lossType: string, description?: string): string[] {\n  const types = new Set<string>()\n  const lt = (lossType || '').toLowerCase()\n  const desc = (description || '').toLowerCase()\n  const combined = `${lt} ${desc}`\n\n  if (/\\b(collision|auto|autocollision|accident|vehicle|car)\\b/.test(combined)) {\n    types.add('collision').add('autocollision').add('auto')\n  }\n  if (/\\b(water|leak|flood|storm|roof|intrusion|ceiling|pipe)\\b/.test(combined)) {\n    types.add('water').add('propertydamage').add('property')\n  }\n  if (/\\b(fire|smoke)\\b/.test(combined)) types.add('fire').add('propertydamage')\n  if (/\\b(theft|stolen)\\b/.test(combined)) types.add('theft').add('propertydamage')\n  if (/\\b(liability|slip|fall|premises|customer|restaurant|business)\\b/.test(combined)) {\n    types.add('liability').add('slip and fall').add('premises')\n  }\n  if (/\\b(property|home|house|property damage)\\b/.test(combined)) {\n    types.add('property').add('propertydamage')\n  }\n\n  if (types.size === 0) {\n    if (lt) types.add(lt.replace(/\\s+/g, ''))\n    types.add('other')\n  }\n  return Array.from(types)\n}\n\nfunction computeSimilarity(\n  clause: PolicyClause,\n  lossTypes: string[],\n  productTypes: string[]\n): number {\n  let score = 0.5\n  const clauseLoss = clause.lossTypes.map((t) => t.toLowerCase())\n  const clauseProduct = clause.productTypes.map((t) => t.toLowerCase())\n  for (const lt of lossTypes) {\n    if (clauseLoss.some((c) => c.includes(lt) || lt.includes(c))) {\n      score += 0.25\n      break\n    }\n  }\n  for (const pt of productTypes) {\n    if (clauseProduct.some((c) => c.includes(pt) || pt.includes(c))) {\n      score += 0.2\n      break\n    }\n  }\n  return Math.min(0.98, score + Math.random() * 0.05)\n}\n\nfunction buildRationale(clause: PolicyClause, lossType: string, policyNumber: string): string {\n  const parts: string[] = []\n  if (lossType) parts.push(`Loss type (${lossType}) matches this clause`)\n  if (policyNumber) parts.push(`Policy product type applicable`)\n  parts.push(`Section: ${clause.section}`)\n  return parts.join('. ')\n}\n\n/**\n * Get policy grounding (matching clauses) based on extracted claim fields.\n */\nexport function getPolicyGrounding(extractedFields: Record<string, unknown>): PolicyHit[] {\n  const policyNumber = String(extractedFields.policyNumber || '').replace(/\\*+/g, '').trim()\n  const lossType = String(extractedFields.lossType || 'Other').trim()\n  const description = String(extractedFields.description || '')\n\n  const productTypes = policyNumber ? inferProductTypes(policyNumber) : ['auto', 'home', 'commercial', 'ac', 'ho', 'cl']\n  const lossTypes = inferLossTypes(lossType, description)\n\n  const scored = POLICY_CLAUSES.map((clause) => {\n    const similarity = computeSimilarity(clause, lossTypes, productTypes)\n    return {\n      ...clause,\n      similarity,\n      rationale: buildRationale(clause, lossType, policyNumber),\n    }\n  })\n\n  scored.sort((a, b) => b.similarity - a.similarity)\n  const hits = scored.slice(0, 5).filter((s) => s.similarity >= 0.6)\n\n  return hits.map((c) => ({\n    clauseId: c.clauseId,\n    title: c.title,\n    snippet: c.content.slice(0, 120) + (c.content.length > 120 ? '...' : ''),\n    content: c.content,\n    section: c.section,\n    score: c.similarity,\n    similarity: c.similarity,\n    rationale: c.rationale,\n    sourceDocument: 'Policy Schedule',\n  }))\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 810, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/lib/confidence.ts"],"sourcesContent":["/**\n * Confidence score thresholds used across the application.\n * All displayed confidence values should be real-time (from extraction), not static.\n */\n\nexport const CONFIDENCE = {\n  /** High: auto-approve / trusted */\n  THRESHOLD_HIGH: 0.8,\n  /** Medium: proceed with normal review */\n  THRESHOLD_MEDIUM: 0.6,\n  /** Low: requires manual review */\n  THRESHOLD_LOW: 0,\n} as const\n\nexport function isHighConfidence(c: number): boolean {\n  return c >= CONFIDENCE.THRESHOLD_HIGH\n}\n\nexport function isMediumConfidence(c: number): boolean {\n  return c >= CONFIDENCE.THRESHOLD_MEDIUM && c < CONFIDENCE.THRESHOLD_HIGH\n}\n\nexport function isLowConfidence(c: number): boolean {\n  return c < CONFIDENCE.THRESHOLD_MEDIUM\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AAEM,MAAM,aAAa;IACxB,iCAAiC,GACjC,gBAAgB;IAChB,uCAAuC,GACvC,kBAAkB;IAClB,gCAAgC,GAChC,eAAe;AACjB;AAEO,SAAS,iBAAiB,CAAS;IACxC,OAAO,KAAK,WAAW,cAAc;AACvC;AAEO,SAAS,mBAAmB,CAAS;IAC1C,OAAO,KAAK,WAAW,gBAAgB,IAAI,IAAI,WAAW,cAAc;AAC1E;AAEO,SAAS,gBAAgB,CAAS;IACvC,OAAO,IAAI,WAAW,gBAAgB;AACxC"}},
    {"offset": {"line": 847, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/app/api/process-claim/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getIngestedClaimById } from '@/lib/ingestedClaims'\nimport { saveProcessedClaim } from '@/lib/processedClaims'\nimport { getPolicyGrounding } from '@/lib/policyClauses'\nimport { CONFIDENCE } from '@/lib/confidence'\nimport { spawn } from 'child_process'\nimport path from 'path'\n\n/**\n * POST /api/process-claim\n * Runs information_extraction.py for LLM-based extraction (email, documents, images with Vision).\n * Returns ClaimData compatible with the app.\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { ingestedClaimId } = body\n\n    if (!ingestedClaimId) {\n      return NextResponse.json(\n        { error: 'ingestedClaimId is required' },\n        { status: 400 }\n      )\n    }\n\n    const claim = getIngestedClaimById(ingestedClaimId)\n    if (!claim) {\n      return NextResponse.json(\n        { error: 'Claim not found' },\n        { status: 404 }\n      )\n    }\n\n    const scriptPath = path.join(process.cwd(), 'information_extraction.py')\n    const pyCmd = process.platform === 'win32' ? 'python' : 'python3'\n\n    const extraction = await new Promise<{\n      extractedFields: Record<string, unknown>\n      documents: Array<{\n        id: string\n        name: string\n        mimeType: string\n        type: string\n        content: string\n        confidence: number\n        keyFields?: Record<string, unknown>\n      }>\n      evidence: Array<{\n        field: string\n        fieldName?: string\n        value: string\n        confidence: number\n        sourceLocator: string\n        rationale: string\n      }>\n      errors: string[]\n    }>((resolve, reject) => {\n      const proc = spawn(pyCmd, [scriptPath, ingestedClaimId], {\n        cwd: process.cwd(),\n        env: { ...process.env },\n      })\n      let stdout = ''\n      let stderr = ''\n      proc.stdout?.on('data', (d) => { stdout += d.toString() })\n      proc.stderr?.on('data', (d) => { stderr += d.toString() })\n      proc.on('close', (code) => {\n        try {\n          const parsed = JSON.parse(stdout.trim())\n          if (parsed.error) {\n            reject(new Error(parsed.error))\n          } else {\n            resolve(parsed)\n          }\n        } catch {\n          reject(new Error(stderr || stdout || `Python exited with code ${code}`))\n        }\n      })\n      proc.on('error', (err) => reject(err))\n    })\n\n    const fields = extraction.extractedFields || {}\n    const maskEmail = (email: string | null) => {\n      if (!email) return 'Not found'\n      const [user, domain] = email.split('@')\n      return `${user.slice(0, 2)}***@${domain}`\n    }\n    const maskPhone = (phone: string | null) => {\n      if (!phone) return 'Not found'\n      return phone.replace(/\\d(?=\\d{4})/g, '*')\n    }\n\n    const now = new Date().toISOString()\n    const claimDraft = {\n      id: `DRAFT-${Date.now()}`,\n      policyNumber: (fields.policyNumber as string)\n        ? `***${String(fields.policyNumber).slice(-3)}`\n        : 'Not found',\n      claimantName: (fields.claimantName as string) || 'Not found',\n      contactEmail: maskEmail((fields.contactEmail as string) ?? null),\n      contactPhone: maskPhone((fields.contactPhone as string) ?? null),\n      lossDate:\n        (fields.lossDate as string) || now.split('T')[0],\n      lossType: (fields.lossType as string) || 'Other',\n      lossLocation: (fields.lossLocation as string) || 'See description',\n      description: (fields.description as string) || 'Claim submitted via email',\n      estimatedAmount: (fields.estimatedAmount as number) ?? (fields.estimatedDamage as number) ?? 0,\n      vehicleInfo: fields.vehicleInfo as Record<string, unknown> | undefined,\n      propertyAddress: fields.propertyAddress as string | undefined,\n      attachments: claim.attachments.map((a, i) => ({\n        id: `doc_${i}`,\n        name: a.name,\n        type: extraction.documents[i]?.type || 'Other',\n        mimeType: a.mimeType,\n        confidence: extraction.documents[i]?.confidence ?? 0.7,\n      })),\n      coverageFound: !!fields.policyNumber,\n      deductible: fields.policyNumber ? 500 : undefined,\n      createdAt: now,\n      source: 'information_extraction',\n      confidence:\n        extraction.evidence.length > 0\n          ? extraction.evidence.reduce((s, e) => s + e.confidence, 0) / extraction.evidence.length\n          : 0,\n    }\n\n    const policyGrounding = getPolicyGrounding(fields)\n\n    const claimId = ingestedClaimId ? `CLM-${ingestedClaimId}` : `CLM-${Date.now()}`\n    const claimData = {\n      claimId,\n      ingestedClaimId,\n      decisionPack: {\n        id: `DP-${Date.now()}`,\n        claimDraft,\n        evidence: extraction.evidence,\n        documents: extraction.documents.map((d) => ({\n          ...d,\n          metadata: {},\n        })),\n        policyGrounding,\n        audit: [\n          {\n            step: 'information_extraction',\n            timestamp: now,\n            duration: 0,\n            agent: 'InformationExtraction',\n            status: 'completed' as const,\n            details: {\n              documentsProcessed: extraction.documents.length,\n              errors: extraction.errors,\n            },\n          },\n        ],\n        evidenceSummary: (() => {\n          const ev = extraction.evidence\n          const total = ev.length\n          const high = ev.filter((e) => e.confidence >= CONFIDENCE.THRESHOLD_HIGH).length\n          const low = ev.filter((e) => e.confidence < CONFIDENCE.THRESHOLD_MEDIUM).length\n          const avg = total > 0 ? ev.reduce((s, e) => s + e.confidence, 0) / total : 0\n          return {\n            totalFields: 8,\n            highConfidenceFields: high,\n            lowConfidenceFields: low,\n            avgConfidence: avg,\n          }\n        })(),\n        documentAnalysis: (() => {\n          const docs = extraction.documents\n          const total = docs.length\n          const avg =\n            total > 0\n              ? docs.reduce((s, d) => s + d.confidence, 0) / total\n              : 0\n          return {\n            totalDocuments: total,\n            documentTypes: docs.map((d) => d.type),\n            avgDocumentConfidence: avg,\n            missingDocuments: [],\n          }\n        })(),\n        policyAssessment: {\n          clausesFound: policyGrounding.length,\n          coverageConfirmed: !!fields.policyNumber && policyGrounding.length > 0,\n          topSimilarityScore: policyGrounding[0]?.score ?? policyGrounding[0]?.similarity ?? 0,\n          recommendedActions:\n            policyGrounding.length > 0\n              ? ['Proceed with claim – policy clauses matched']\n              : ['Manual review – no matching policy clauses found'],\n        },\n        processingSummary: {\n          totalTime: 0,\n          stepsCompleted: 4,\n          stepsWithErrors: extraction.errors.length,\n          automationLevel: 0.9,\n        },\n        createdAt: now,\n      },\n      auditTrail: [\n        {\n          step: 'process_claim',\n          timestamp: now,\n          duration: 0,\n          agent: 'ProcessClaimAPI',\n          status: 'completed' as const,\n          details: { openaiIntegration: 'active', model: 'gpt-4o' },\n        },\n      ],\n      processingMetrics: {\n        totalProcessingTime: 0,\n        averageHandleTime: 0,\n        fieldsAutoPopulated: extraction.evidence.length,\n        overrideRate: 0.1,\n        ragHitRate: 1.0,\n        stepsCompleted: 4,\n        stepsFailed: extraction.errors.length,\n        successRate: extraction.errors.length === 0 ? 1.0 : 0.9,\n      },\n      createdAt: now,\n      status: 'draft',\n    }\n\n    saveProcessedClaim(claimData as import('@/types/claims').ClaimData)\n    return NextResponse.json(claimData)\n  } catch (error) {\n    console.error('Process claim error:', error)\n    return NextResponse.json(\n      { error: 'Claim processing failed', details: String(error) },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}