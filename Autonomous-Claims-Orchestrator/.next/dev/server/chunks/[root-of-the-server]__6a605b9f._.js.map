{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/app/api/sync-inbox/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { spawn } from 'child_process'\nimport path from 'path'\n\n/**\n * POST /api/sync-inbox\n * Runs the Python email_auto_ingestion module to fetch unread emails and ingest them.\n */\nexport async function POST() {\n  try {\n    const scriptPath = path.join(process.cwd(), 'email_auto_ingestion.py')\n    const pyCmd = process.platform === 'win32' ? 'python' : 'python3'\n    const result = await new Promise<{\n      success: boolean\n      ingested: number\n      scanned: number\n      skippedNoFnol: number\n      errors: string[]\n    }>((resolve, reject) => {\n      const proc = spawn(pyCmd, [scriptPath], {\n        cwd: process.cwd(),\n        env: { ...process.env },\n      })\n      let stdout = ''\n      let stderr = ''\n      proc.stdout?.on('data', (d) => { stdout += d.toString() })\n      proc.stderr?.on('data', (d) => { stderr += d.toString() })\n      proc.on('close', (code) => {\n        try {\n          const parsed = JSON.parse(stdout.trim())\n          resolve(parsed)\n        } catch {\n          reject(new Error(stderr || stdout || `Python exited with code ${code}`))\n        }\n      })\n      proc.on('error', (err) => reject(err))\n    })\n\n    return NextResponse.json({\n      success: result.success,\n      ingested: result.ingested,\n      scanned: result.scanned,\n      skippedNoFnol: result.skippedNoFnol,\n      skippedDuplicate: result.skippedDuplicate ?? 0,\n      errors: result.errors,\n      hint: result.hint,\n    })\n  } catch (error) {\n    console.error('Sync inbox error:', error)\n    return NextResponse.json(\n      { success: false, ingested: 0, scanned: 0, skippedNoFnol: 0, skippedDuplicate: 0, errors: [String(error)] },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAMO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAC5C,MAAM,QAAQ,sCAA+B,0BAAW;QACxD,MAAM,SAAS,MAAM,IAAI,QAMtB,CAAC,SAAS;YACX,MAAM,OAAO,IAAA,4HAAK,EAAC,OAAO;gBAAC;aAAW,EAAE;gBACtC,KAAK,QAAQ,GAAG;gBAChB,KAAK;oBAAE,GAAG,QAAQ,GAAG;gBAAC;YACxB;YACA,IAAI,SAAS;YACb,IAAI,SAAS;YACb,KAAK,MAAM,EAAE,GAAG,QAAQ,CAAC;gBAAQ,UAAU,EAAE,QAAQ;YAAG;YACxD,KAAK,MAAM,EAAE,GAAG,QAAQ,CAAC;gBAAQ,UAAU,EAAE,QAAQ;YAAG;YACxD,KAAK,EAAE,CAAC,SAAS,CAAC;gBAChB,IAAI;oBACF,MAAM,SAAS,KAAK,KAAK,CAAC,OAAO,IAAI;oBACrC,QAAQ;gBACV,EAAE,OAAM;oBACN,OAAO,IAAI,MAAM,UAAU,UAAU,CAAC,wBAAwB,EAAE,MAAM;gBACxE;YACF;YACA,KAAK,EAAE,CAAC,SAAS,CAAC,MAAQ,OAAO;QACnC;QAEA,OAAO,wLAAY,CAAC,IAAI,CAAC;YACvB,SAAS,OAAO,OAAO;YACvB,UAAU,OAAO,QAAQ;YACzB,SAAS,OAAO,OAAO;YACvB,eAAe,OAAO,aAAa;YACnC,kBAAkB,OAAO,gBAAgB,IAAI;YAC7C,QAAQ,OAAO,MAAM;YACrB,MAAM,OAAO,IAAI;QACnB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,wLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,UAAU;YAAG,SAAS;YAAG,eAAe;YAAG,kBAAkB;YAAG,QAAQ;gBAAC,OAAO;aAAO;QAAC,GAC1G;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}