{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/frontend/app/api/send-email/route.ts"],"sourcesContent":["/**\n * POST /api/send-email\n * Sends an email using SMTP (Gmail) with SENDER_EMAIL and EMAIL_PASSWORD from .env\n */\nimport { NextRequest, NextResponse } from 'next/server'\nimport nodemailer from 'nodemailer'\n\nconst SENDER_EMAIL = process.env.SENDER_EMAIL || process.env.MAIL_USERNAME || ''\nconst EMAIL_PASSWORD = (process.env.EMAIL_PASSWORD || process.env.MAIL_PASSWORD || '').replace(/\\s/g, '')\n\nfunction createTransporter() {\n  if (!SENDER_EMAIL || !EMAIL_PASSWORD) {\n    throw new Error('Mail credentials not configured. Set SENDER_EMAIL and EMAIL_PASSWORD in .env')\n  }\n  const isGmail = SENDER_EMAIL.toLowerCase().includes('gmail.com')\n  if (isGmail) {\n    return nodemailer.createTransport({\n      service: 'gmail',\n      auth: {\n        user: SENDER_EMAIL,\n        pass: EMAIL_PASSWORD,\n      },\n    })\n  }\n  return nodemailer.createTransport({\n    host: process.env.SMTP_HOST || 'smtp.gmail.com',\n    port: parseInt(process.env.SMTP_PORT || '587', 10),\n    secure: process.env.SMTP_SECURE === 'true',\n    auth: {\n      user: SENDER_EMAIL,\n      pass: EMAIL_PASSWORD,\n    },\n  })\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { to, subject, body: emailBody } = body\n\n    if (!to || typeof to !== 'string') {\n      return NextResponse.json({ error: 'Recipient email (to) is required' }, { status: 400 })\n    }\n    if (!emailBody || typeof emailBody !== 'string') {\n      return NextResponse.json({ error: 'Email body is required' }, { status: 400 })\n    }\n\n    const finalSubject = subject && typeof subject === 'string' ? subject : 'Claim Correspondence'\n\n    if (!SENDER_EMAIL || !EMAIL_PASSWORD) {\n      return NextResponse.json(\n        { error: 'Mail credentials not configured. Set SENDER_EMAIL and EMAIL_PASSWORD in .env' },\n        { status: 503 }\n      )\n    }\n\n    const transporter = createTransporter()\n    const info = await transporter.sendMail({\n      from: `\"Claims Department\" <${SENDER_EMAIL}>`,\n      to: to.trim(),\n      subject: finalSubject,\n      text: emailBody,\n      html: emailBody.replace(/\\n/g, '<br>'),\n    })\n\n    return NextResponse.json({\n      success: true,\n      messageId: info.messageId,\n      message: 'Email sent successfully',\n    })\n  } catch (err) {\n    console.error('Send email error:', err)\n    const message = err instanceof Error ? err.message : 'Failed to send email'\n    return NextResponse.json({ error: message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;AACA;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,aAAa,IAAI;AAC9E,MAAM,iBAAiB,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI,QAAQ,GAAG,CAAC,aAAa,IAAI,EAAE,EAAE,OAAO,CAAC,OAAO;AAEtG,SAAS;IACP,IAAI,CAAC,gBAAgB,CAAC,gBAAgB;QACpC,MAAM,IAAI,MAAM;IAClB;IACA,MAAM,UAAU,aAAa,WAAW,GAAG,QAAQ,CAAC;IACpD,IAAI,SAAS;QACX,OAAO,oMAAU,CAAC,eAAe,CAAC;YAChC,SAAS;YACT,MAAM;gBACJ,MAAM;gBACN,MAAM;YACR;QACF;IACF;IACA,OAAO,oMAAU,CAAC,eAAe,CAAC;QAChC,MAAM,QAAQ,GAAG,CAAC,SAAS,IAAI;QAC/B,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI,OAAO;QAC/C,QAAQ,QAAQ,GAAG,CAAC,WAAW,KAAK;QACpC,MAAM;YACJ,MAAM;YACN,MAAM;QACR;IACF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,SAAS,EAAE,GAAG;QAEzC,IAAI,CAAC,MAAM,OAAO,OAAO,UAAU;YACjC,OAAO,wLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACxF;QACA,IAAI,CAAC,aAAa,OAAO,cAAc,UAAU;YAC/C,OAAO,wLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,eAAe,WAAW,OAAO,YAAY,WAAW,UAAU;QAExE,IAAI,CAAC,gBAAgB,CAAC,gBAAgB;YACpC,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA+E,GACxF;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,cAAc;QACpB,MAAM,OAAO,MAAM,YAAY,QAAQ,CAAC;YACtC,MAAM,CAAC,qBAAqB,EAAE,aAAa,CAAC,CAAC;YAC7C,IAAI,GAAG,IAAI;YACX,SAAS;YACT,MAAM;YACN,MAAM,UAAU,OAAO,CAAC,OAAO;QACjC;QAEA,OAAO,wLAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,WAAW,KAAK,SAAS;YACzB,SAAS;QACX;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,OAAO,wLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF"}}]
}