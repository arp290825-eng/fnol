{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/frontend/lib/drafts.ts"],"sourcesContent":["/**\n * Drafts service - creates core-system drafts from extracted claim data.\n * Persists structured draft records incorporating all extracted details.\n */\n\nimport fs from 'fs'\nimport path from 'path'\nimport type { ClaimData } from '@/types/claims'\n\n// Project root is parent of frontend when running from frontend/\nconst PROJECT_ROOT = path.resolve(process.cwd(), '..')\nconst DATA_DIR = path.join(PROJECT_ROOT, 'data')\nconst DRAFTS_DIR = path.join(DATA_DIR, 'drafts')\nconst INDEX_FILE = path.join(DRAFTS_DIR, 'drafts-index.json')\n\nexport interface CoreDraft {\n  draftId: string\n  claimId: string\n  ingestedClaimId?: string\n  status: 'pending' | 'submitted' | 'approved' | 'rejected'\n  createdAt: string\n  /** Extracted claim fields for core system */\n  claimFields: {\n    policyNumber: string\n    claimantName: string\n    contactEmail: string\n    contactPhone?: string\n    lossDate: string\n    lossType: string\n    lossLocation?: string\n    description: string\n    estimatedAmount?: number\n    deductible?: number\n    propertyAddress?: string\n    vehicleInfo?: Record<string, unknown>\n  }\n  attachments: Array<{\n    id: string\n    name: string\n    type?: string\n    mimeType: string\n    confidence?: number\n  }>\n  evidenceSummary?: {\n    totalFields: number\n    highConfidenceFields: number\n    lowConfidenceFields: number\n    avgConfidence: number\n  }\n  policyClauses: Array<{\n    clauseId: string\n    title: string\n    section?: string\n    score?: number\n  }>\n  recommendedActions: string[]\n  documentTypes: string[]\n}\n\nfunction ensureDir(): void {\n  if (!fs.existsSync(DATA_DIR)) fs.mkdirSync(DATA_DIR, { recursive: true })\n  if (!fs.existsSync(DRAFTS_DIR)) fs.mkdirSync(DRAFTS_DIR, { recursive: true })\n}\n\nfunction getIndex(): Array<{ draftId: string; claimId: string; createdAt: string }> {\n  ensureDir()\n  if (!fs.existsSync(INDEX_FILE)) return []\n  try {\n    return JSON.parse(fs.readFileSync(INDEX_FILE, 'utf-8'))\n  } catch {\n    return []\n  }\n}\n\nfunction saveIndex(index: ReturnType<typeof getIndex>): void {\n  ensureDir()\n  fs.writeFileSync(INDEX_FILE, JSON.stringify(index, null, 2), 'utf-8')\n}\n\n/** Build and save a core system draft from claim data */\nexport function createDraft(claimData: ClaimData): CoreDraft {\n  ensureDir()\n\n  const { claimId, ingestedClaimId, decisionPack } = claimData\n  const draftId = `DRAFT-${claimId || `CLM-${Date.now()}`}-${Date.now()}`\n  const draft = claimData.decisionPack?.claimDraft\n  const policyGrounding = decisionPack?.policyGrounding || []\n  const documents = decisionPack?.documents || []\n  const policyAssessment = decisionPack?.policyAssessment\n\n  const coreDraft: CoreDraft = {\n    draftId,\n    claimId: claimId || draftId,\n    ingestedClaimId,\n    status: 'pending',\n    createdAt: new Date().toISOString(),\n    claimFields: {\n      policyNumber: draft?.policyNumber || '',\n      claimantName: draft?.claimantName || '',\n      contactEmail: draft?.contactEmail || '',\n      contactPhone: draft?.contactPhone,\n      lossDate: draft?.lossDate || '',\n      lossType: draft?.lossType || 'Other',\n      lossLocation: draft?.lossLocation || draft?.location,\n      description: draft?.description || '',\n      estimatedAmount: draft?.estimatedAmount,\n      deductible: draft?.deductible,\n      propertyAddress: draft?.propertyAddress,\n      vehicleInfo: draft?.vehicleInfo,\n    },\n    attachments: draft?.attachments || [],\n    evidenceSummary: decisionPack?.evidenceSummary,\n    policyClauses: policyGrounding.map((p) => ({\n      clauseId: p.clauseId,\n      title: p.title,\n      section: p.section,\n      score: p.score ?? p.similarity,\n    })),\n    recommendedActions: policyAssessment?.recommendedActions || [],\n    documentTypes: documents.map((d) => d.type),\n  }\n\n  const filePath = path.join(DRAFTS_DIR, `${draftId.replace(/[/\\\\:]/g, '_')}.json`)\n  fs.writeFileSync(filePath, JSON.stringify(coreDraft, null, 2), 'utf-8')\n\n  const index = getIndex()\n  index.unshift({ draftId, claimId: coreDraft.claimId, createdAt: coreDraft.createdAt })\n  saveIndex(index)\n\n  return coreDraft\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AACA;;;AAGA,iEAAiE;AACjE,MAAM,eAAe,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AACjD,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,cAAc;AACzC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AACvC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,YAAY;AA8CzC,SAAS;IACP,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW,wGAAE,CAAC,SAAS,CAAC,UAAU;QAAE,WAAW;IAAK;IACvE,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa,wGAAE,CAAC,SAAS,CAAC,YAAY;QAAE,WAAW;IAAK;AAC7E;AAEA,SAAS;IACP;IACA,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa,OAAO,EAAE;IACzC,IAAI;QACF,OAAO,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,YAAY;IAChD,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEA,SAAS,UAAU,KAAkC;IACnD;IACA,wGAAE,CAAC,aAAa,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM,IAAI;AAC/D;AAGO,SAAS,YAAY,SAAoB;IAC9C;IAEA,MAAM,EAAE,OAAO,EAAE,eAAe,EAAE,YAAY,EAAE,GAAG;IACnD,MAAM,UAAU,CAAC,MAAM,EAAE,WAAW,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI;IACvE,MAAM,QAAQ,UAAU,YAAY,EAAE;IACtC,MAAM,kBAAkB,cAAc,mBAAmB,EAAE;IAC3D,MAAM,YAAY,cAAc,aAAa,EAAE;IAC/C,MAAM,mBAAmB,cAAc;IAEvC,MAAM,YAAuB;QAC3B;QACA,SAAS,WAAW;QACpB;QACA,QAAQ;QACR,WAAW,IAAI,OAAO,WAAW;QACjC,aAAa;YACX,cAAc,OAAO,gBAAgB;YACrC,cAAc,OAAO,gBAAgB;YACrC,cAAc,OAAO,gBAAgB;YACrC,cAAc,OAAO;YACrB,UAAU,OAAO,YAAY;YAC7B,UAAU,OAAO,YAAY;YAC7B,cAAc,OAAO,gBAAgB,OAAO;YAC5C,aAAa,OAAO,eAAe;YACnC,iBAAiB,OAAO;YACxB,YAAY,OAAO;YACnB,iBAAiB,OAAO;YACxB,aAAa,OAAO;QACtB;QACA,aAAa,OAAO,eAAe,EAAE;QACrC,iBAAiB,cAAc;QAC/B,eAAe,gBAAgB,GAAG,CAAC,CAAC,IAAM,CAAC;gBACzC,UAAU,EAAE,QAAQ;gBACpB,OAAO,EAAE,KAAK;gBACd,SAAS,EAAE,OAAO;gBAClB,OAAO,EAAE,KAAK,IAAI,EAAE,UAAU;YAChC,CAAC;QACD,oBAAoB,kBAAkB,sBAAsB,EAAE;QAC9D,eAAe,UAAU,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;IAC5C;IAEA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY,GAAG,QAAQ,OAAO,CAAC,WAAW,KAAK,KAAK,CAAC;IAChF,wGAAE,CAAC,aAAa,CAAC,UAAU,KAAK,SAAS,CAAC,WAAW,MAAM,IAAI;IAE/D,MAAM,QAAQ;IACd,MAAM,OAAO,CAAC;QAAE;QAAS,SAAS,UAAU,OAAO;QAAE,WAAW,UAAU,SAAS;IAAC;IACpF,UAAU;IAEV,OAAO;AACT"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/frontend/app/api/drafts/route.ts"],"sourcesContent":["/**\n * POST /api/drafts\n * Creates a core system draft incorporating extracted claim details.\n */\nimport { NextRequest, NextResponse } from 'next/server'\nimport { createDraft } from '@/lib/drafts'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n\n    if (!body?.decisionPack?.claimDraft) {\n      return NextResponse.json(\n        { error: 'Invalid claim data - decisionPack.claimDraft required' },\n        { status: 400 }\n      )\n    }\n\n    const draft = createDraft(body as import('@/types/claims').ClaimData)\n\n    return NextResponse.json({\n      success: true,\n      draftId: draft.draftId,\n      claimId: draft.claimId,\n      draft,\n      message: 'Draft created in core system with extracted details',\n    })\n  } catch (error) {\n    console.error('Create draft error:', error)\n    return NextResponse.json(\n      { error: 'Failed to create draft', details: String(error) },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,IAAI,CAAC,MAAM,cAAc,YAAY;YACnC,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwD,GACjE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,IAAA,kLAAW,EAAC;QAE1B,OAAO,wLAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS,MAAM,OAAO;YACtB,SAAS,MAAM,OAAO;YACtB;YACA,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,wLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA0B,SAAS,OAAO;QAAO,GAC1D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}