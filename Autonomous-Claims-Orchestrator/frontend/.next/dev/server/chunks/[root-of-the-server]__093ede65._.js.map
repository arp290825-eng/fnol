{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/frontend/lib/backend.ts"],"sourcesContent":["/**\n * Backend bridge - spawns Python microservices from Next.js API routes.\n * Project root is parent of frontend/ when running from frontend/.\n */\n\nimport { spawn } from 'child_process'\nimport path from 'path'\n\nconst PROJECT_ROOT = path.resolve(process.cwd(), '..')\nconst PY_CMD = process.platform === 'win32' ? 'python' : 'python3'\n\nexport interface SpawnResult {\n  stdout: string\n  stderr: string\n  code: number\n}\n\nexport function runPython(\n  module: string,\n  args: string[],\n  stdin?: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const proc = spawn(PY_CMD, ['-m', module, ...args], {\n      cwd: PROJECT_ROOT,\n      env: { ...process.env, PYTHONPATH: PROJECT_ROOT },\n      stdio: stdin !== undefined ? ['pipe', 'pipe', 'pipe'] : ['ignore', 'pipe', 'pipe'],\n    })\n\n    let stdout = ''\n    let stderr = ''\n\n    proc.stdout?.on('data', (d) => { stdout += d.toString() })\n    proc.stderr?.on('data', (d) => { stderr += d.toString() })\n\n    if (stdin !== undefined && proc.stdin) {\n      proc.stdin.write(stdin, 'utf-8')\n      proc.stdin.end()\n    }\n\n    proc.on('close', (code) => {\n      if (code !== 0) {\n        reject(new Error(stderr || stdout || `Python exited with code ${code}`))\n      } else {\n        resolve(stdout)\n      }\n    })\n\n    proc.on('error', (err) => reject(err))\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AACA;;;AAEA,MAAM,eAAe,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AACjD,MAAM,SAAS,sCAA+B,0BAAW;AAQlD,SAAS,UACd,MAAc,EACd,IAAc,EACd,KAAc;IAEd,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,OAAO,IAAA,4HAAK,EAAC,QAAQ;YAAC;YAAM;eAAW;SAAK,EAAE;YAClD,KAAK;YACL,KAAK;gBAAE,GAAG,QAAQ,GAAG;gBAAE,YAAY;YAAa;YAChD,OAAO,UAAU,YAAY;gBAAC;gBAAQ;gBAAQ;aAAO,GAAG;gBAAC;gBAAU;gBAAQ;aAAO;QACpF;QAEA,IAAI,SAAS;QACb,IAAI,SAAS;QAEb,KAAK,MAAM,EAAE,GAAG,QAAQ,CAAC;YAAQ,UAAU,EAAE,QAAQ;QAAG;QACxD,KAAK,MAAM,EAAE,GAAG,QAAQ,CAAC;YAAQ,UAAU,EAAE,QAAQ;QAAG;QAExD,IAAI,UAAU,aAAa,KAAK,KAAK,EAAE;YACrC,KAAK,KAAK,CAAC,KAAK,CAAC,OAAO;YACxB,KAAK,KAAK,CAAC,GAAG;QAChB;QAEA,KAAK,EAAE,CAAC,SAAS,CAAC;YAChB,IAAI,SAAS,GAAG;gBACd,OAAO,IAAI,MAAM,UAAU,UAAU,CAAC,wBAAwB,EAAE,MAAM;YACxE,OAAO;gBACL,QAAQ;YACV;QACF;QAEA,KAAK,EAAE,CAAC,SAAS,CAAC,MAAQ,OAAO;IACnC;AACF"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranaynath/Documents/GitHub/fnol/Autonomous-Claims-Orchestrator/frontend/app/api/ingested-claims/%5Bid%5D/attachments/route.ts"],"sourcesContent":["/**\n * GET /api/ingested-claims/[id]/attachments?name=filename.jpg\n * Serves attachment file. Uses backend to get claim, then reads file from path.\n */\nimport { NextRequest, NextResponse } from 'next/server'\nimport fs from 'fs'\nimport path from 'path'\nimport { runPython } from '@/lib/backend'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const name = request.nextUrl.searchParams.get('name')\n    if (!name) {\n      return NextResponse.json(\n        { error: 'name query parameter required' },\n        { status: 400 }\n      )\n    }\n\n    const stdout = await runPython('backend.ingested_claims', ['get', id])\n    const trimmed = stdout.trim()\n    if (trimmed === 'null') {\n      return NextResponse.json({ error: 'Claim not found' }, { status: 404 })\n    }\n\n    const claim = JSON.parse(trimmed)\n    const att = claim.attachments?.find((a: { name: string }) => a.name === name)\n    if (!att || !att.path) {\n      return NextResponse.json(\n        { error: 'Attachment not found' },\n        { status: 404 }\n      )\n    }\n\n    const filePath = path.isAbsolute(att.path)\n      ? att.path\n      : path.resolve(process.cwd(), '..', att.path)\n\n    if (!fs.existsSync(filePath)) {\n      return NextResponse.json(\n        { error: 'Attachment file not found' },\n        { status: 404 }\n      )\n    }\n\n    const ext = path.extname(att.name).toLowerCase()\n    const imageExts = ['.jpg', '.jpeg', '.png', '.gif', '.webp']\n    const isImage =\n      imageExts.includes(ext) ||\n      (att.mimeType || '').startsWith('image/')\n    if (!isImage) {\n      return NextResponse.json(\n        { error: 'Not an image attachment' },\n        { status: 400 }\n      )\n    }\n\n    const buffer = fs.readFileSync(filePath)\n    return new NextResponse(buffer, {\n      headers: {\n        'Content-Type': att.mimeType || 'image/jpeg',\n        'Cache-Control': 'public, max-age=3600',\n      },\n    })\n  } catch (error) {\n    console.error('Attachment serve error:', error)\n    return NextResponse.json(\n      { error: 'Failed to serve attachment' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;AACA;AACA;AACA;;;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QAC9C,IAAI,CAAC,MAAM;YACT,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,IAAA,iLAAS,EAAC,2BAA2B;YAAC;YAAO;SAAG;QACrE,MAAM,UAAU,OAAO,IAAI;QAC3B,IAAI,YAAY,QAAQ;YACtB,OAAO,wLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,QAAQ,KAAK,KAAK,CAAC;QACzB,MAAM,MAAM,MAAM,WAAW,EAAE,KAAK,CAAC,IAAwB,EAAE,IAAI,KAAK;QACxE,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE;YACrB,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,4GAAI,CAAC,UAAU,CAAC,IAAI,IAAI,IACrC,IAAI,IAAI,GACR,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,MAAM,IAAI,IAAI;QAE9C,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW;YAC5B,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,WAAW;QAC9C,MAAM,YAAY;YAAC;YAAQ;YAAS;YAAQ;YAAQ;SAAQ;QAC5D,MAAM,UACJ,UAAU,QAAQ,CAAC,QACnB,CAAC,IAAI,QAAQ,IAAI,EAAE,EAAE,UAAU,CAAC;QAClC,IAAI,CAAC,SAAS;YACZ,OAAO,wLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,wGAAE,CAAC,YAAY,CAAC;QAC/B,OAAO,IAAI,wLAAY,CAAC,QAAQ;YAC9B,SAAS;gBACP,gBAAgB,IAAI,QAAQ,IAAI;gBAChC,iBAAiB;YACnB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,wLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}